/*! projectdemo 2016-06-03 */
"use strict";function getConnection(){var a=q.defer(),b=mysql.createConnection({host:"127.0.0.1",port:3306,user:"root",password:"",database:"cloudproject"});return b.connect(function(c){c&&(console.error(c),a.reject(c)),console.log(LOG_PREFIX+"Connection created with id:"+b.threadId),a.resolve(b)}),a.promise}function prepareQuery(a,b){if(!a||!b)throw new Error("query and parameters function parameters should be specified.");return mysql.format(a,b)}function getForum(a){var b=q.defer(),c=[],d="";return"All"===a?(d="select q.*, (select round(AVG(rating)) from rating where qusId=q.qusId) as rating from question as q order by qusId DESC",console.log(d)):d="select * from question where Type='"+a+"' order by qusId DESC ",ConfigManager.getConnection().then(function(a){a.query(d,function(d,e){if(d)throw b.reject(d),d;e&&(data=e,console.log(JSON.stringify(data[0])),console.log(JSON.stringify(data.length)),data.forEach(function(d,e){console.log(d);var f="select * from answer where qusId="+d.qusId+" order by id DESC";console.log("get answer query"+f),a.query(f,function(a,f){if(a)throw b.reject(a),a;console.log(f),f&&(d.answers=f,console.log("value"+JSON.stringify(d)),c.push(d),e+1>=data.length&&b.resolve(c))})}))})}),b.promise}function postForumquestion(a,b){var c=q.defer();return ConfigManager.getConnection().then(function(d){d.query("INSERT INTO question(Question,Dates,Type,Explation,userid) values('"+a.question+"',now(),'"+a.Type+"','"+a.explation+"','"+b+"')",function(a,b){a?(console.log(a),c.reject(a)):(console.log("Successfully"),c.resolve(b))})}),c.promise}function postForumAnswer(a){var b=q.defer();return ConfigManager.getConnection().then(function(c){var d="INSERT INTO answer(qusId,Date,Answers)values("+a.qusId+",now(),'"+a.Comment+"')";console.log("Post Answer Query --->"+d),c.query(d,function(a,c){return a?(console.log("Error when get postAnswer data : "+a),void b.reject(a)):(console.log(c),void b.resolve(c))})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)}),b.promise}function postForumRating(a){var b=q.defer();return ConfigManager.getConnection().then(function(c){c.query("insert into Rating(qusId,rating) values("+a[0]+","+a[1]+")",function(c,d){console.log("insert into Rating(qusId,rating) values("+a[0]+","+a[1]+")"),c?(console.log(c),b.reject(c)):(console.log("Successfully"),b.resolve({affectedRows:d.affectedRows}))})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)}),b.promise}function getUserValidity(a,b){var c=q.defer();return connectionManager.getConnection().then(function(d){d.query("SELECT id FROM personaldata where userid = '"+a+"' and password = '"+b+"' and status = 'active'",function(a,b){a&&(console.error(a),c.reject(a)),c.resolve(b)})}).fail(function(a){console.error(JSON.stringify(a)),c.reject(a)}),c.promise}function getUserDetails(a){var b=q.defer();return connectionManager.getConnection().then(function(c){c.query("Select * from personaldata where status = 'active' and userType = '"+a+"'",function(a,c){a&&(console.error(a),b.reject(a)),b.resolve(c)})}),b.promise}function getPersonalData(a){var b=q.defer();return connectionManager.getConnection().then(function(c){c.query("SELECT * FROM personaldata where id ="+a+" and status = 'active'",function(a,c){a&&(console.error(a),b.reject(a)),b.resolve(c)})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)}),b.promise}function updatePersonalData(a){var b=q.defer();return deletePersonalData(a.id).then(function(){var c="Insert into personaldata(facebook_id,facebook_token,google_id,google_token,userid,password,";c+="userType,fname,mname,lname,email,fb_fname,fb_mname,fb_lname,fb_email,",c+="g_fname,g_mname,g_lname,g_email,contact,address,college,course,branch,year,project_fee,fees_paid,",c+="fees_balance,createdDate,deletedDate,status,profile_pic,facebook_img,google_img)",c+=" values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,now(),?,?,?,?,?)",console.log("Query template"+c),connectionManager.getConnection().then(function(d){var e=connectionManager.prepareQuery(c,[a.facebook_id,a.facebook_token,a.google_id,a.google_token,a.userid,a.password,a.userType,a.fname,a.mname,a.lname,a.email,a.fb_fname,a.fb_mname,a.fb_lname,a.fb_email,a.g_fname,a.g_mname,a.g_lname,a.g_email,a.contact,a.address,a.college,a.course,a.branch,a.year,a.project_fee,a.fees_paid,a.fees_balance,a.deletedDate,"active",a.profile_pic,a.facebook_img,a.google_img]);console.log("Query to execute:"+e),d.query(e,function(a,c){a&&(console.error(a),b.reject(a)),getPersonalData(c.insertId).then(function(a){b.resolve(a)})})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)})}),b.promise}function deletePersonalData(a){var b=q.defer(),c="Update personaldata set status = 'Move to trash',deletedDate = now() where id = ? and status = ?";return connectionManager.getConnection().then(function(d){var e=connectionManager.prepareQuery(c,[a,"active"]);console.log("Delete query:"+e),d.query(e,function(a,c){a&&(console.error(a),b.reject(a)),b.resolve({affectedRows:c.affectedRows})})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)}),b.promise}function updateImage(a){var b=q.defer();return updatePersonalData(a).then(function(a){b.resolve(a)}),b.promise}function updateFacebookPersonalData(a,b,c){var d=q.defer(),e=[];if(a&&a.session&&a.session.data)e=a.session.data,e.facebook_id=b.id,e.facebook_token=c,b.name.givenName?e.fb_fname=b.name.givenName:b.displayName&&(e.fb_fname=b.displayName),b.name.familyName&&(e.fb_lname=b.name.familyName),b.emails&&b.emails[0]&&(e.fb_email=b.emails[0].value),updatePersonalData(e).then(function(){updateFacebookProfilePicture(b).then(function(a){d.resolve(a)})});else{var f="select * from personaldata where facebook_id = ? and status = ?";connectionManager.getConnection().then(function(a){var g=connectionManager.prepareQuery(f,[b.id,"active"]);console.log("Select query:"+g),a.query(g,function(a,f){a&&(console.error(a),d.reject(a)),f&&f.length>0?(e=f[0],e.facebook_id=b.id,e.facebook_token=c,b.name.givenName?e.fb_fname=b.name.givenName:b.displayName&&(e.fb_fname=b.displayName),b.name.familyName&&(e.fb_lname=b.name.familyName),b.emails&&b.emails[0]&&(e.fb_email=b.emails[0].value),updatePersonalData(e).then(function(){updateFacebookProfilePicture(b).then(function(a){d.resolve(a)})})):insertFacebookProfileData(b,c).then(function(){updateFacebookProfilePicture(b).then(function(a){d.resolve(a)})})})}).fail(function(a){console.error(JSON.stringify(a)),d.reject(a)})}return d.promise}function updateFacebookProfilePicture(a){var b=q.defer();return connectionManager.getConnection().then(function(c){c.query("SELECT * FROM personaldata where facebook_id ="+a.id+" and status = 'active'",function(c,d){c&&(console.error(c),b.reject(c)),http.get(a.photos[0].value,function(c){var e=[],f=0;c.on("data",function(a){f+=a.length,e.push(a)}),c.on("end",function(){var c=Buffer.concat(e),f="public/uploads/profile/file-"+a.id+"."+fileType(c).ext;fs.writeFile(f,c,function(e){if(e)console.log("Error---->"+e);else{var f=d[0];f.facebook_img="file-"+a.id+"."+fileType(c).ext,updateImage(f).then(function(a){b.resolve(a)})}})})})})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)}),b.promise}function deleteFacebookProfileData(a){var b=q.defer(),c="Update personaldata set status = 'Move to trash',deletedDate = now() where facebook_id = ? and status = ?";return connectionManager.getConnection().then(function(d){var e=connectionManager.prepareQuery(c,[a.id,"active"]);console.log("Delete query:"+e),d.query(e,function(a,c){a&&(console.error(a),b.reject(a)),b.resolve({affectedRows:c.affectedRows})})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)}),b.promise}function insertFacebookProfileData(a,b){var c=q.defer(),d="Insert into personaldata(facebook_id,facebook_token";return a.name.givenName?d+=",fb_fname":a.displayName&&(d+=",fb_fname"),a.name.familyName&&(d+=",fb_lname"),a.emails&&a.emails[0]&&(d+=",fb_email"),d+=",createdDate,status,userType) values ("+a.id+",'"+b+"'",a.name.givenName?d+=",'"+a.name.givenName+"'":a.displayName&&(d+=",'"+a.displayName+"'"),a.name.familyName&&(d+=",'"+a.name.familyName+"'"),a.emails&&a.emails[0]&&(d+=",'"+a.emails[0].value+"'"),d+=",now(),'active','user')",connectionManager.getConnection().then(function(a){console.log("Insert query:"+d),a.query(d,function(a,b){a&&(console.error(a),c.reject(a)),c.resolve({affectedRows:b.affectedRows})})}).fail(function(a){console.error(JSON.stringify(a)),c.reject(a)}),c.promise}function updateGooglePersonalData(a,b,c){var d=q.defer(),e=[];if(a&&a.session&&a.session.data)e=a.session.data,e.google_id=b.id,e.google_token=c,b.name.givenName?e.g_fname=b.name.givenName:b.displayName&&(e.g_fname=b.displayName),b.name.familyName&&(e.g_lname=b.name.familyName),b.email&&(e.g_email=b.email),updatePersonalData(e).then(function(a){console.log("Result"+a),updateGoogleProfilePicture(b).then(function(a){d.resolve(a)})});else{var f="select * from personaldata where google_id = ? and status = ?";connectionManager.getConnection().then(function(a){var g=connectionManager.prepareQuery(f,[b.id,"active"]);console.log("Select query:"+g),a.query(g,function(a,f){a&&(console.error(a),d.reject(a)),f&&f.length>0?(e=f[0],e.google_id=b.id,e.google_token=c,b.name.givenName?e.g_fname=b.name.givenName:b.displayName&&(e.g_fname=b.displayName),b.name.familyName&&(e.g_lname=b.name.familyName),b.email&&(e.g_email=b.email),updatePersonalData(e).then(function(a){console.log("Result"+a),updateGoogleProfilePicture(b).then(function(a){d.resolve(a)})})):insertGoogleProfileData(b,c).then(function(){updateGoogleProfilePicture(b).then(function(a){d.resolve(a)})})})}).fail(function(a){console.error(JSON.stringify(a)),d.reject(a)})}return d.promise}function updateGoogleProfilePicture(a){var b=q.defer();return connectionManager.getConnection().then(function(c){c.query("SELECT * FROM personaldata where google_id ="+a.id+" and status = 'active'",function(c,d){c&&(console.error(c),b.reject(c)),http.get(a.photos[0].value,function(c){var e=[],f=0;c.on("data",function(a){f+=a.length,e.push(a)}),c.on("end",function(){var c=Buffer.concat(e),f="public/uploads/profile/file-"+a.id+"."+fileType(c).ext;fs.writeFile(f,c,function(e){if(e)console.log("Error---->"+e);else{var f=d[0];f.google_img="file-"+a.id+"."+fileType(c).ext,updateImage(f).then(function(a){b.resolve(a)})}})})})})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)}),b.promise}function deleteGoogleProfileData(a){var b=q.defer(),c="Update personaldata set status = 'Move to trash',deletedDate = now() where google_id = ? and status = ?";return connectionManager.getConnection().then(function(d){var e=connectionManager.prepareQuery(c,[a.id,"active"]);console.log("Delete query:"+e),d.query(e,function(a,c){a&&(console.error(a),b.reject(a)),b.resolve({affectedRows:c.affectedRows})})}).fail(function(a){console.error(JSON.stringify(a)),b.reject(a)}),b.promise}function insertGoogleProfileData(a,b){var c=q.defer(),d="Insert into personaldata(google_id,google_token";return a.name.givenName?d+=",g_fname":a.displayName&&(d+=",g_fname"),a.name.familyName&&(d+=",g_lname"),a.email&&(d+=",g_email"),d+=",createdDate,status,userType) values ('"+a.id+"','"+b+"'",a.name.givenName?d+=",'"+a.name.givenName+"'":a.displayName&&(d+=",'"+a.displayName+"'"),a.name.familyName&&(d+=",'"+a.name.familyName+"'"),a.email&&(d+=",'"+a.email+"'"),d+=",now(),'active','user')",connectionManager.getConnection().then(function(a){console.log("Insert query:"+d),a.query(d,function(a,b){a&&(console.error(a),c.reject(a)),c.resolve({affectedRows:b.affectedRows})})}).fail(function(a){console.error(JSON.stringify(a)),c.reject(a)}),c.promise}module.exports=function(a){this.getAllDep=function(b){var c,d;a.query("select * from tbl_department",function(a,e){a?(d=a,b(d,c)):(c=e,b(d,c))})},this.getDepById=function(b,c){var d,e;a.query("select * from tbl_department WHERE DEP_ID="+b,function(a,b){a?(e=a,c(e,d)):(d=b,c(e,d))})}},module.exports=function(a){this.insertDoc=function(b,c){var d=null,e=null,f="INSERT INTO TBL_DOCUMENTS SET ? ";a.query(f,b,function(a,b){a?(d=a,c(d,e)):(e=b.insertId,c(d,b.insertId))})},this.getAllDoc=function(b,c){var d=null,e=null,f="SELECT A.*,B.*,COALESCE(FLOOR(AVG(C.STARS)),0) as star FROM TBL_DOCUMENTS A LEFT OUTER join TBL_DEPARTMENT B on (A.DOCDEP=B.DEP_ID) LEFT OUTER JOIN  TBL_DOC_STARS C  on  A.ID=C.DOC_ID WHERE A.DOCCAPTION LIKE '"+b+"%' GROUP BY A.id";console.log(f),a.query(f,function(a,b){a?(d=a,c(d,e)):(console.log(b),e=b,c(d,e))})},this.updateDoc=function(b,c,d){var e=null,f=null,g="UPDATE TBL_DOCUMENTS SET ? WHERE ID="+b;a.query(g,c,function(a,b){a?(e=a,d(e,f)):(f=b,d(e,f))})},this.deleteDoc=function(b,c){var d=null,e=null,f={}.constructor;if(""===b||null===b)return!1;if(b.constructor!==f)return void c("not an object",e);var g="DELETE  FROM TBL_DOCUMENTS WHERE ?";a.query(g,b,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})},this.getDocById=function(b,c){var d=null,e=null,f="SELECT  * FROM TBL_DOCUMENTS WHERE ID="+b;a.query(f,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})},this.getDocByDep=function(b,c,d){var e=null,f=null,g="SELECT A.*,B.*,COALESCE(FLOOR(AVG(C.STARS)),0) as star FROM TBL_DOCUMENTS A LEFT OUTER join TBL_DEPARTMENT B on (A.DOCDEP=B.DEP_ID) LEFT OUTER JOIN  TBL_DOC_STARS C  on  A.ID=C.DOC_ID WHERE A.DOCDEP="+c+" AND A.DOCCAPTION LIKE '"+b+"%' GROUP BY C.doc_id,A.ID";a.query(g,c,function(a,b){a?(e=a,d(e,f)):(f=b,d(e,f))})},this.getDocByType=function(b,c,d){var e=null,f=null,g="SELECT A.*,B.*,COALESCE(FLOOR(AVG(C.STARS)),0) as star FROM TBL_DOCUMENTS A LEFT OUTER join TBL_DEPARTMENT B on (A.DOCDEP=B.DEP_ID) LEFT OUTER JOIN  TBL_DOC_STARS C  on  A.ID=C.DOC_ID WHERE A.DOCTYPE="+c+" AND A.DOCCAPTION LIKE '"+b+"%' GROUP BY C.doc_id,A.ID";a.query(g,c,function(a,b){a?(e=a,d(e,f)):(f=b,d(e,f))})},this.getDocByTypeDep=function(b,c,d,e){var f=null,g=null,h="SELECT A.*,B.*,COALESCE(FLOOR(AVG(C.STARS)),0) as star FROM TBL_DOCUMENTS A LEFT OUTER join TBL_DEPARTMENT B on (A.DOCDEP=B.DEP_ID) LEFT OUTER JOIN  TBL_DOC_STARS C  on  A.ID=C.DOC_ID WHERE A.DOCTYPE="+c+" AND A.DOCDEP="+d+" AND A.DOCCAPTION LIKE '"+b+"%' GROUP BY C.doc_id,A.ID";console.log(h),a.query(h,c,function(a,b){a?(f=a,e(f,g)):(g=b,e(f,g))})},this.incrViews=function(b,c){var d="UPDATE TBL_DOCUMENTS SET DOCNOVIEWS = DOCNOVIEWS + 1 WHERE id ="+b;a.query(d,function(a,b){c(a,JSON.stringify(b))})},this.incrDown=function(b,c){var d="UPDATE TBL_DOCUMENTS SET DOCNODOWN = DOCNODOWN + 1 WHERE id ="+b;a.query(d,function(a,b){c(a,JSON.stringify(b))})},this.getLatestDoc=function(b,c){var d=null,e=null,f="select * from tbl_documents where DOCDEP="+b+" ORDER BY ID  DESC LIMIT 5";a.query(f,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})},this.getLatestVid=function(b,c){var d=null,e=null,f="select * from tbl_documents where doctype="+b+" ORDER BY ID  DESC LIMIT 2";a.query(f,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})},this.getLatestImg=function(b,c){var d=null,e=null,f='select a.*,b.*,substring_index(a.docfile,".",-1) as type from tbl_documents a inner join tbl_department b on a.docdep=b.dep_id where doctype='+b+" ORDER BY ID  DESC LIMIT 4";a.query(f,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})},this.getLatestArchives=function(b,c){var d=null,e=null,f='select a.*,b.*,substring_index(a.docfile,".",-1) as type from tbl_documents a inner join tbl_department b on a.docdep=b.dep_id where doctype='+b+" ORDER BY ID  DESC LIMIT 4";a.query(f,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})},this.getNextDocument=function(b,c){var d=null,e=null,f="select * from TBL_DOCUMENTS where id = (select min(id) from TBL_DOCUMENTS where id > "+b+" )";a.query(f,function(a,b){if(a)throw a;console.log(b)}),a.query(f,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})},this.getPrevDocument=function(b,c){var d=null,e=null,f="select * from TBL_DOCUMENTS where id = (select max(id) from TBL_DOCUMENTS where id < "+b+" )";a.query(f,function(a,b){if(a)throw a;console.log(b)}),a.query(f,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})}},module.exports=function(a){this.getStarInfo=function(b,c){var d=null,e=null;a.query("select a.*,b.fname,b.lname from tbl_doc_stars a LEFT OUTER JOIN personaldata b ON a.USER_ID=b.id where a.doc_id="+b+" ORDER BY a.ID",function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})},this.setStar=function(b,c){var d=null,e=null,f="INSERT INTO TBL_DOC_STARS SET ?";console.log(b);var g={}.constructor;return b.constructor!==g?void c("not an object",e):void a.query(f,b,function(a,b){a?(d=a,c(d,e)):(e=b.insertId,c(d,b.insertId))})},this.getStar=function(b,c){var d=null,e=null,f="SELECT FLOOR(AVG(STARS)) AS STR FROM TBL_DOC_STARS WHERE DOC_ID="+b;a.query(f,function(a,b){a?(d=a,c(d,e)):(e=b,c(d,e))})}};var mysql=require("mysql"),q=require("q"),LOG_PREFIX="[CONN] - ";module.exports={getConnection:getConnection,prepareQuery:prepareQuery};var q=require("q"),data="",ConfigManager=require("./connectionManager");module.exports={getForum:getForum,postForumquestion:postForumquestion,postForumAnswer:postForumAnswer,postForumRating:postForumRating};var q=require("q"),connectionManager=require("./connectionManager");module.exports={getUserValidity:getUserValidity};var q=require("q"),http=require("https"),fs=require("fs");const fileType=require("file-type");var connectionManager=require("./connectionManager");module.exports={getPersonalData:getPersonalData,updatePersonalData:updatePersonalData,deletePersonalData:deletePersonalData,updateFacebookPersonalData:updateFacebookPersonalData,deleteFacebookProfileData:deleteFacebookProfileData,insertFacebookProfileData:insertFacebookProfileData,updateImage:updateImage,updateFacebookProfilePicture:updateFacebookProfilePicture,updateGooglePersonalData:updateGooglePersonalData,deleteGoogleProfileData:deleteGoogleProfileData,insertGoogleProfileData:insertGoogleProfileData,updateGoogleProfilePicture:updateGoogleProfilePicture,getUserDetails:getUserDetails},module.exports={sessionSecret:"developmentSessionSecret"},module.exports={facebookAuth:{clientID:"1399396623700627",clientSecret:"70e23a7b527d251394f172daa413a7ca",callbackURL:"http://localhost:3000/auth/facebook/callback"},googleAuth:{clientID:"92955044095-h9rrm4lpt7jc3q1cgjj0mu9m5euoa4kt.apps.googleusercontent.com",clientSecret:"B-PyTKfjQCXpztN31qmNWNzV",callbackURL:"http://localhost:3000/auth/google/callback"}},module.exports=require("./env/"+process.env.NODE_ENV+".js"),module.exports={host:"localhost",user:"root",password:"",database:"cloudproject"};var config=require("./config"),express=require("express"),morgan=require("morgan"),compress=require("compression"),bodyParser=require("body-parser"),methodOverride=require("method-override"),passport=require("passport"),session=require("express-session");module.exports=function(){var a=express();"development"===process.env.NODE_ENV?a.use(morgan("dev")):"production"===process.env.NODE_ENV&&a.use(compress()),a.use(bodyParser.urlencoded({extended:!0})),a.use(bodyParser.json()),a.use(methodOverride()),a.use(session({saveUninitialized:!0,resave:!0,secret:config.sessionSecret})),a.use(function(a,b,c){b.header("Access-Control-Allow-Origin","http://localhost"),b.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),c()});var b=new session.MemoryStore;return a.use(passport.initialize()),a.use(passport.session()),a.use(session({secret:"something",store:b})),a.use(function(a,b,c){b.header("Access-Control-Allow-Origin","http://localhost"),b.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),b.header("Access-Control-Allow-Origin","http://localhost:3000/auth/facebook"),c()}),a.use(express["static"]("./public")),require("../routes/project.home.server.routes.js")(a),require("../routes/project.upload.server.routes.js")(a),require("../routes/profile.login.server.routes.js")(a),require("../routes/profile.userProfile.server.routes.js")(a),require("../routes/profile.adminDashboard.server.routes.js")(a),require("../routes/profile.adminProfile.server.routes.js")(a),require("../routes/profile.changePassword.server.routes")(a),require("../routes/profile.logout.server.routes")(a),require("../routes/forum.home.server.routes.js")(a),require("../routes/documents.documentList.server.routes")(a),require("../routes/documents.singleFileUpload.server.routes")(a),require("../routes/documents.multipleFileUpload.server.routes")(a),require("../routes/documents.star.server.routes")(a),require("../routes/documents.viewDocument.server.routes")(a),require("../routes/documents.search.server.routes")(a),require("../routes/project.projectReg.server.route")(a),require("../routes/security.server.routes.js")(a),require("../routes/layout.server.routes.js")(a),a};var mysql=require("mysql"),db=require("../config/db"),serDocument=require("../config/db/documents/documentdb"),con=mysql.createConnection(db),docService=new serDocument(con);exports.searchDocument=function(a,b){var c,d=a.query.docType,e=a.query.dep,f=a.query.serStr;console.log(a.session.userMode),b.writeHead(200,{"Content-Type":"application/json"}),console.log("type:"+d+"dep="+e),-1==d&&-1==e?docService.getAllDoc(f,function(a,d){c=d,console.log(d),b.end(JSON.stringify(c))}):-1==d?docService.getDocByDep(f,e,function(a,d){c=d,b.end(JSON.stringify(c))}):-1==e?docService.getDocByType(f,d,function(a,d){c=d,b.end(JSON.stringify(c))}):docService.getDocByTypeDep(f,d,e,function(a,d){c=d,b.end(JSON.stringify(c))})},exports.editDocument=function(a,b){var c=a.query.id;docService.getDocById(c,function(a,c){if(a)throw a;b.end(JSON.stringify(c))})},exports.deleteDocument=function(a,b){var c=a.body;console.log(c),docService.deleteDoc(c,function(){console.log("Deleted Record...."+c),b.end()})};var path=require("path"),mysql=require("mysql"),fs=require("fs"),db=require("../config/db"),serDocument=require("../config/db/documents/documentdb"),con=mysql.createConnection(db),docService=new serDocument(con);exports.uploadMultiple=function(a,b){var c={},d=new Date;console.log(a.path);var e=require("formidable");console.log(a.body);var f,g=!1,h=function(){},i=null,j=0;h=function(a,b){i=b,console.log("i: "+j),fs.createReadStream(l["docFile"+j].path).pipe(fs.createWriteStream(__dirname+"/../public/uploads/documents/"+l["docFile"+j].name)),fs.rename(__dirname+"/../public/uploads/documents/"+l["docFile"+j].name,__dirname+"/../public/uploads/documents/"+i+f,function(a){if(a)throw a;console.log(a),g=!0})};var k=new e.IncomingForm,l={},m={};k.on("field",function(a,b){m[a]=b}),k.on("file",function(a,b){console.log(b.name),l[a]=b}),k.on("end",function(){for(console.log("done"),console.log(m),console.log(l),console.log(Object.keys(l).length),j=1;j<=Object.keys(l).length;j++)for(g=!1,f=path.extname(l["docFile"+j].name),console.log(m["docCaption"+j]),c.docDate=d,c.docCaption=m["docCaption"+j],c.docType=m["docType"+j],c.docDep=m["docDep"+j],c.docKey=m["docKey"+j],c.docDesc=m["docDesc"+j],c.docFile=l["docFile"+j].name,console.log(c),docService.insertDoc(c,h);!g;)require("deasync").sleep(1e3)}),k.parse(a),b.redirect("/multiUpload")};var mysql=require("mysql"),db=require("../config/db"),serDocument=require("../config/db/documents/documentdb"),con=mysql.createConnection(db),docService=new serDocument(con);exports.searchDocument=function(a,b){var c,d=a.query.docType,e=a.query.dep,f=a.query.serStr;console.log(a.session.userMode),b.writeHead(200,{"Content-Type":"application/json"}),console.log("type:"+d+"dep="+e),-1==d&&-1==e?docService.getAllDoc(f,function(a,d){c=d,console.log(d),b.end(JSON.stringify(c))}):-1==d?docService.getDocByDep(f,e,function(a,d){c=d,b.end(JSON.stringify(c))}):-1==e?docService.getDocByType(f,d,function(a,d){c=d,b.end(JSON.stringify(c))}):docService.getDocByTypeDep(f,d,e,function(a,d){c=d,b.end(JSON.stringify(c))})};var path=require("path"),mysql=require("mysql"),fs=require("fs"),db=require("../config/db"),serDocument=require("../config/db/documents/documentdb"),serDepartment=require("../config/db/documents/departmentdb"),con=mysql.createConnection(db),docService=new serDocument(con),depServiceObj=new serDepartment(con);exports.upload=function(a,b){var c={},d=new Date;console.log(a.path);var e=require("formidable"),f=new e.IncomingForm;f.parse(a,function(a,e,f){console.log(f.docFile.name);var g=path.extname(f.docFile.name);c.docDate=d,c.docCaption=e.docCaption,c.docType=e.docType,c.docDep=e.docDep,c.docKey=e.docKey,c.docDesc=e.docDesc,c.docFile=f.docFile.name;var h=null;""!==e.docId?docService.updateDoc(e.docId,c,function(a,b){h=b,fs.createReadStream(f.docFile.path).pipe(fs.createWriteStream(__dirname+"/../public/uploads/documents/"+f.docFile.name)),fs.rename(__dirname+"/../public/uploads/documents/"+f.docFile.name,__dirname+"/../public/uploads/documents/"+h+g,function(a){if(a)throw a})}):docService.insertDoc(c,function(a,b){h=b,fs.createReadStream(f.docFile.path).pipe(fs.createWriteStream(__dirname+"/../public/uploads/documents/"+f.docFile.name)),fs.rename(__dirname+"/../public/uploads/documents/"+f.docFile.name,__dirname+"/../public/uploads/documents/"+h+g,function(a){if(a)throw a;console.log(a)})}),b.redirect("/adminHome")})},exports.getDepartment=function(a,b){depServiceObj.getAllDep(function(a,c){if(a)throw a;console.log(c),b.end(JSON.stringify(c))})};var mysql=require("mysql"),db=require("../config/db"),serRating=require("../config/db/documents/ratingdb"),con=mysql.createConnection(db),serReatingObj=new serRating(con);exports.setStar=function(a,b){var c=a.body;c.USER_ID=a.session.data.id,serReatingObj.setStar(c,function(a,c){if(a)throw a;console.log(b.status),console.log(c)})},exports.getStar=function(a,b){var c=a.query.DOC_ID;serReatingObj.getStar(c,function(a,c){if(a)throw a;b.end(JSON.stringify(c))})},exports.getRatingInfo=function(a,b){var c=a.query.id;serReatingObj.getStarInfo(c,function(a,c){console.log(c),b.end(JSON.stringify(c))})};var mysql=require("mysql"),fs=require("fs"),admZip=require("adm-zip"),db=require("../config/db"),serDocument=require("../config/db/documents/documentdb"),con=mysql.createConnection(db),docService=new serDocument(con),unZipFile=function(){};unZipFile=function(a){var b=!1,c=[],d="";for(docService.getDocById(a,function(e,f){d=f[0].DOCFILE;var g=d.substring(d.lastIndexOf(".")+1),h=new admZip(__dirname+"/../public/uploads/documents/"+a+"."+g),i=h.getEntries();i.forEach(function(a){c.push({file:a.entryName}),console.log(c)}),b=!0});!b;)return require("deasync").sleep(1e3),c},exports.viewDocument=function(a,b){var c=a.query.id;docService.incrViews(c,function(a){if(a)throw a}),b.json={mode:a.session.userMode}},exports.downloadDocument=function(a,b){var c=a.query.id;console.log(c);var d,e="";docService.getDocById(c,function(a,f){d=f[0].DOCFILE,e=d.substring(d.lastIndexOf(".")+1),docService.incrDown(c,function(a,d){if(a)throw a;console.log(d),fs.access(__dirname+"/../public/uploads/documents/"+c+"."+e,fs.F_OK,function(a){a?b.end("No file found"):b.download(__dirname+"/../public/uploads/documents/"+c+"."+e)})})})},exports.nextDocument=function(a,b){var c=a.query.id;docService.getNextDocument(c,function(a,c){console.log(c),b.end(JSON.stringify(c))})},exports.prevDocument=function(a,b){var c=a.query.id;docService.getPrevDocument(c,function(a,c){console.log(c),b.end(JSON.stringify(c))})},exports.userMode=function(a,b,c){var d={mode:a.session.userMode};console.log(d),"Admin"==d?c():b.send("error"),b.end(JSON.stringify(d))},exports.readZip=function(a,b){var c=a.query.id;console.log(c);var d=unZipFile(c);console.log("inside"),b.end(JSON.stringify(d))};var express=require("express"),forumConfig=require("../config/db/forumManager"),router=express.Router();router.get("/getForum",function(a,b){forumConfig.getForum(a.query.type).then(function(a,c){a?b.send(a):console.error(c)}).fail(function(a){console.error(JSON.stringify(a))})}),router.post("/postForumquestion",function(a,b){forumConfig.postForumquestion(a.body,a.session.data.userid).then(function(a,c){a?b.send(a):console.error(c)}).fail(function(a){console.error(JSON.stringify(a))})}),router.post("/postAnswer",function(a,b){forumConfig.postForumAnswer(a.body).then(function(a,c){a?b.send(a):console.error(c)}).fail(function(a){console.error(JSON.stringify(a))})}),router.post("/rating",function(a,b){forumConfig.postForumRating(a.body).then(function(a,c){a?b.send(a):console.error(c)}).fail(function(a){console.error(JSON.stringify(a))})}),module.exports=router,exports.layout=function(a,b){b.sendfile("./public/app/core/layout.html")};var personaldataManager=require("../config/db/personaldataManager");exports.getUserDetails=function(a,b){a.session.data&&personaldataManager.getUserDetails("user").then(function(c){c&&(a.session.userDetails=c,b.send(c))}).fail(function(a){console.error(JSON.stringify(a))})};var passport=require("passport"),express=require("express"),configAuth=require("../config/auth"),facebookStrategy=require("passport-facebook").Strategy,googleStrategy=require("passport-google-oauth2").Strategy,loginManager=require("../config/db/loginManager"),personalDataManager=require("../config/db/personaldataManager"),router=express.Router();passport.serializeUser(function(a,b){b(null,a)}),passport.deserializeUser(function(a,b){b(null,a)}),passport.use(new facebookStrategy({clientID:configAuth.facebookAuth.clientID,clientSecret:configAuth.facebookAuth.clientSecret,callbackURL:configAuth.facebookAuth.callbackURL,profileFields:["id","displayName","photos","email"],passReqToCallback:!0},function(a,b,c,d,e){personalDataManager.updateFacebookPersonalData(a,d,b).then(function(a){return a?e(null,a):void 0}).fail(function(a){console.error(JSON.stringify(a))})})),passport.use(new googleStrategy({clientID:configAuth.googleAuth.clientID,clientSecret:configAuth.googleAuth.clientSecret,callbackURL:configAuth.googleAuth.callbackURL,passReqToCallback:!0},function(a,b,c,d,e){personalDataManager.updateGooglePersonalData(a,d,b).then(function(a){return a?e(null,a):e(null)}).fail(function(a){return console.error(JSON.stringify(a)),e(null)})})),router.post("/verifyUser",function(a,b){loginManager.getUserValidity(a.body.user,a.body.password).then(function(c){c&&(a.session.data=c[0],b.send(c[0]))}).fail(function(a){console.error(JSON.stringify(a))})}),router.get("/facebook",passport.authenticate("facebook",{scope:["email","user_friends","manage_pages","user_hometown"]})),router.get("/facebook/callback",passport.authenticate("facebook",{successRedirect:"/profile/userDashboard",failureRedirect:"/"})),router.get("/google",passport.authenticate("google",{scope:["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/plus.profile.emails.read"]})),router.get("/google/callback",passport.authenticate("google",{successRedirect:"/profile/userDashboard",failureRedirect:"/"})),module.exports=router,exports.logout=function(a,b){a.session.destroy(),b.sendfile("./public/app/core/layout.html",{title:"Logged Out"})};var passport=require("passport"),configAuth=require("../config/auth"),facebookStrategy=require("passport-facebook").Strategy,googleStrategy=require("passport-google-oauth2").Strategy,personaldataManager=require("../config/db/personaldataManager"),express=require("express"),router=express.Router();passport.serializeUser(function(a,b){b(null,a)}),passport.deserializeUser(function(a,b){b(null,a)}),passport.use(new facebookStrategy({clientID:configAuth.facebookAuth.clientID,clientSecret:configAuth.facebookAuth.clientSecret,callbackURL:configAuth.facebookAuth.callbackURL,profileFields:["id","displayName","photos","email"],passReqToCallback:!0},function(a,b,c,d,e){personaldataManager.updateFacebookPersonalData(a,d,b).then(function(b){return b?(a.session.data=b[0],e(null,b)):void 0}).fail(function(a){console.error(JSON.stringify(a))})})),passport.use(new googleStrategy({clientID:configAuth.googleAuth.clientID,clientSecret:configAuth.googleAuth.clientSecret,callbackURL:configAuth.googleAuth.callbackURL,passReqToCallback:!0},function(a,b,c,d,e){personaldataManager.updateGooglePersonalData(a,d,b).then(function(a){return a?e(null,a):e(null)}).fail(function(a){return console.error(JSON.stringify(a)),e(null);
})})),router.get("/getPersonalData",function(a,b){(a.session.data&&a.session.data.id||a.session.passport)&&(a.session.passport&&(a.session.data=[],a.session.data.id=a.session.passport.user[0].id),personaldataManager.getPersonalData(a.session.data.id).then(function(c){c&&(a.session.data=c[0],b.send(c[0]))}).fail(function(a){console.error(JSON.stringify(a))}))}),router.post("/updatePersonalData",function(a,b){a.session.data&&a.session.data.id&&personaldataManager.updatePersonalData(a.body).then(function(a){a&&b.send(a)}).fail(function(a){console.error(JSON.stringify(a))})}),router.get("/google",passport.authenticate("google",{scope:["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/plus.profile.emails.read"]})),router.get("/google/callback",passport.authenticate("google",{successRedirect:"/profile",failureRedirect:"/"})),router.get("/facebook",passport.authenticate("facebook",{scope:["email","user_friends","manage_pages","user_hometown"]})),router.get("/facebook/callback",passport.authenticate("facebook",{successRedirect:"/profile",failureRedirect:"/"})),module.exports=router;var mysql=require("mysql"),dateFormat=require("dateformat"),db=require("../config/db"),connection=mysql.createConnection(db);exports.data=function(a,b){connection.query("Select * from project",function(a,c){a?console.log("Error when get project data : "+a):(console.log(c),b.send(c))})},exports.projectHistory=function(a,b){connection.query("Select * from projectDetails",function(a,c){a?console.log("Error when get projectHistory data : "+a):(console.log(c),b.send(c))})},exports.chartData=function(a,b){connection.query("Select * from chart",function(a,c){a?console.log("Error when get chart data : "+a):(console.log(c),b.send(c))})},exports.imageData=function(a,b){connection.query("select * from images where fileName like 'CB2-1516-CSD0001%'",function(a,c){a?console.log("Error when get imageData : "+a):(console.log(c),b.send(c))})},exports.postQuestion=function(a,b){var c=new Date;connection.query("Insert into questions(Question, createdBy, createdAt) values('"+a.body+"','Ganesh','"+dateFormat(c,"dddd, mmmm dS, yyyy, h:MM:ss TT")+"')",function(a,c){a?console.log("Error when get postQuestion data : "+a):(console.log(c),b.send(c))})};var mysql=require("mysql"),db=require("../config/db"),connection=mysql.createConnection(db);exports.getData=function(a,b){var c="select * from erp_database";console.log("get the data from DB"+c),connection.query(c,function(a,c){a?console.log("Error when get questions data : "+a):(console.log(c),b.send(c))})},exports.postData=function(a,b){var c="INSERT INTO erp_database set ? ";console.log("store the data in DB"+c),connection.query(c,a.body,function(a,c){a?console.log("Error when post question :"+a):(console.log(c),b.send(c))})},exports.EditData=function(a,b){var c="UPDATE erp_database set projectCode = '"+a.body.projectCode+"',Title = '"+a.body.Title+"', Department = '"+a.body.Department+"',";c+="subHeads = '"+a.body.subHeads+"',Software = "+a.body.Software+",Hardware = "+a.body.Hardware+", catlogCode = '"+a.body.catlogCode+"',",c+="Domain = '"+a.body.Domain+"' where id="+a.body.id,connection.query(c,function(a,c){a?console.log("error when update the data :"+a):(console.log(c),b.send(c))})},exports.DeleteData=function(a,b){console.log(a.params.id);var c="DELETE from erp_database where id='"+a.params.id+"'";connection.query(c,function(a,c){a?console.log("error when delete the data :"+a):(console.log(c),b.send(c))})};var multer=require("multer"),event=require("events"),mysql=require("mysql"),db=require("../config/db"),connection=mysql.createConnection(db),EventEmitter=event.EventEmitter,emitter=new EventEmitter;exports.upload=function(a,b){var c=multer.diskStorage({destination:function(a,b,c){c(null,"./public/images/uploads/")},filename:function(a,b,c){c(null,"CB2-1516-CSD0001."+b.originalname),emitter.emit("image-upload","CB2-1516-CSD0001."+b.originalname)}}),d=multer({storage:c}).single("file");d(a,b,function(a){return a?(console.log(a),void b.json({errorCode:1,errDesc:a})):void b.json({errorCode:0,errDesc:null})}),emitter.on("image-upload",function(a){console.log("Image upload begin..."),connection.query("Insert into images values('"+a+"')",function(a,b){return a?void console.log("Error when upload image fileName : "+a):void console.log(b)})})},exports.getLoggedInUser=function(a,b){a.session&&a.session.data&&b.send(a.session.data)},myApp.config(function(a,b){a.when("/",{controller:"loginController",templateUrl:"../app/profile/login/login.html"}).when("/profile/userProfile",{controller:"userProfileController",templateUrl:"../app/profile/userProfile/userProfile.html"}).when("/profile/userDashboard",{templateUrl:"../app/profile/userDashboard/userDashboard.html",controller:"userDashboardController"}).when("/profile/adminDashboard",{templateUrl:"../app/profile/adminDashboard/adminDashboard.html",controller:"adminDashboardController"}).when("/profile/adminProfile",{templateUrl:"../app/profile/adminProfile/adminProfile.html",controller:"adminProfileController"}).when("/profile/chooseProfileViews",{templateUrl:"../app/profile/userProfile/modal/chooseProfileViews.html",controller:"profileViewModalController"}).when("/profile/changePassword",{templateUrl:"../app/profile/changePassword/changePassword.html",controller:"changePasswordController"}).when("/logout",{templateUrl:"../app/profile/logout/logout.html",controller:"logoutController"}).when("/project/home",{controller:"homeController",templateUrl:"../app/project/home/home.html"}).when("/project/upload",{controller:"uploadController",controllerAs:"up",templateUrl:"../app/project/upload/upload.html"}).when("/project/projectReg",{controller:"projectRegController",templateUrl:"../app/project/projectReg/projectReg.html"}).when("/forum/home",{controller:"forumController",templateUrl:"../app/forum/home/forum.html"}).when("/documents/editDoc",{templateUrl:"app/documents/singleFileUpload/singleFileUpload.html",controller:"singleFileUploadController"}).when("/documents/singleFileUpload",{templateUrl:"app/documents/singleFileUpload/singleFileUpload.html",controller:"singleFileUploadController"}).when("/documents/documentSearch",{templateUrl:"app/documents/search/search.html",controller:"searchController"}).when("/documents/documentList",{templateUrl:"app/documents/documentList/documentList.html",controller:"documentListController"}).when("/documents/multipleFileUpload",{templateUrl:"app/documents/multipleFileUpload/multipleFileUpload.html",controller:"multipleFileUploadController"}).when("/documents/viewDocument",{templateUrl:"app/documents/viewDocument/viewDocument.html",controller:"viewDocumentController"}).when("/error",{templateUrl:"../app/core/error.html"}).otherwise({redirectTo:"/error"}),b.html5Mode(!0)}),function(){function a(a){a.isLogin=!1}myApp.controller("layoutController",a)}();var myApp=angular.module("myApp",["ngRoute","angular-timeline","uiAccordion","ngFileUpload","ngProgress","angularSpinners","ui.bootstrap"]);console.log(myApp+"module loaded"),myApp.directive("validFile",function(){return{require:"ngModel",link:function(a,b,c,d){b.bind("change",function(){a.$apply(function(){d.$setViewValue(b.val()),d.$render()})})}}}),myApp.controller("documentListController",function(a,b,c,d,e,f){a.formData=[],a.filteredRes=[],a.searchres=[],a.docs={},a.search="",a.searchkey={},a.searchkey.dep=-1,a.curPage=1,a.itemsPage=5,a.searchkey.docType=-1,a.isReverse=!1,a.filteredDoc=[],a.field="DOCCAPTION",a.maxSize=5,a.rateInfo=[],a.popup="",a.dep="",a.type=[{id:-1,type:"All Document",ptrn:""},{id:1,type:"PDF Document",ptrn:".pdf"},{id:2,type:"Word Document",ptrn:".docx"},{id:3,type:"Slide Document",ptrn:".ppt"},{id:4,type:"Image Document",ptrn:"image/*"},{id:5,type:"Archive Document",ptrn:"*.zip|*.rar"},{id:6,type:"Video Document",ptrn:".mp4"}],e.checkAdmin(),a.orderMe=function(b){return a.field==b?void(a.isReverse=!a.isReverse):(a.field=b,void(a.isReverse=!1))},a.getRateInfo=function(b){c.getStarInfo(b).success(function(b){a.rateInfo=b,a.popup={visibility:"visible",opacity:1},console.log(a.rateInfo)}).error(function(){})},a.newDocument=function(){b.newDocument()},a.getData=function(){b.get().success(function(b){a.docs=b,a.$watch("cur_page + items_page",function(){var b=(a.curPage-1)*a.itemsPage,c=b+a.itemsPage;a.filteredDoc=a.docs.slice(b,c)})})},a.getDepartment=function(){b.getDepartment().success(function(b){a.dep=b,a.dep.splice(0,0,{DEP_ID:"-1",DEP_NAME:"All Department"})}).error(function(a){console.log(a)})},a.searchData=function(){b.search("?docType="+a.searchkey.docType+"&dep="+a.searchkey.dep+"&page="+a.page+"&serStr="+a.search).success(function(b){a.searchres=b,b.length<=0?a.noData=!0:a.noData=!1,a.$watch("curPage + itemsPage",function(){var b=(a.curPage-1)*a.itemsPage,c=b+a.itemsPage;a.filteredRes=a.searchres.slice(b,c)})})},a.getIcon=function(a){return d.getIcon(a)},a.editDoc=function(c){a.selId=a.docs[c].ID,b.edit().success(function(a){console.log(a)})},a.deleteDoc=function(c){a.selId=c,b["delete"]({ID:+a.selId}).success(function(b){console.log(b),console.log("deleted"),a.searchData()}).error(function(){a.searchData()})},a.onLogout=function(){f.confirm("Are You Sure ! Do you need to Log Out?")&&b.logout()},a.goToDashboard=function(){b.goToDashboard()},a.getDepartment(),a.searchData()}),myApp.factory("documentListServices",function(a,b){return{"delete":function(b){return a.post("/api/docs/delete",b)},edit:function(b){return a.get("/api/docs/edit?id="+b)},search:function(b){return a.get("/api/search"+b)},getDepartment:function(){return a.get("/api/dep")},newDocument:function(){b.location.href="/documents/singleFileUpload"},logout:function(){b.location.href="/logout"},goToDashboard:function(){b.location.href="/profile/adminDashboard"}}}),myApp.filter("myDate",function(a){return function(b){if(null===b)return"";var c=a("date")(new Date(b),"dd-MM-yyyy");return c}}),myApp.controller("multipleFileUploadController",function(a,b,c,d){a.formData=[{ID:"",DOC_CAPTION:"",DOC_TYPE:"",DOC_DEP:"",DOC_KEY:"",DOC_DESC:"",DOC_FILE:""}],a.rows=[1,2],a.docs={},a.isErr=!1,a.isNull=!0,a.docPattern="",a.dep=[],a.type=[{id:1,type:"PDF Document",ptrn:".pdf"},{id:2,type:"Word Document",ptrn:".docx"},{id:3,type:"Slide Document",ptrn:".ppt"},{id:4,type:"Image Document",ptrn:"image/*"},{id:5,type:"Archive Document",ptrn:"*.zip|*.rar"},{id:6,type:"Video Document",ptrn:".mp4"}],c.checkAdmin(),a.addRow=function(){a.rows.push(a.rows.length+1)},a.removeRow=function(){a.rows.length<=2||a.rows.splice(a.rows.length-1,1)},a.getPattern=function(b){a.docPattern=a.type[b-1].ptrn},a.saveDoc=function(){alert("Saved Successfully"),document.forms.frmDoc.submit()},a.singleFileUpload=function(){b.singleFileUpload().then(function(){})},a.getParameterByName=function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)","i"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},a.getDepartment=function(){b.getDepartment().success(function(b){a.dep=b}).error(function(a){console.log(a)})},a.onLogout=function(){d.confirm("Are You Sure ! Do you need to Log Out?")&&b.logout()},a.goToDashboard=function(){b.goToDashboard()},a.getDepartment()}),myApp.factory("uploadMultipleServices",function(a,b){return{create:function(b){return a.post("/uploadMulti",b)},getDepartment:function(){return a.get("/api/dep")},singleFileUpload:function(){b.location.href="/documents/singleFileUpload"},logout:function(){b.location.href="/logout"},goToDashboard:function(){b.location.href="/profile/adminDashboard"}}}),myApp.controller("searchController",function(a,b,c,d,e){a.searchkey={},a.searchkey.docType=-1,a.searchkey.dep=-1,a.searchres=[],a.search="",a.curPage=1,a.itemsPage=6,a.filteredRes=[],a.maxSize=5,a.noData=!1,a.dep=[],a.loadimage="",a.stLst=!1,a.field="DOCCAPTION",a.isReverse=!1,a.srcViews="app/documents/search/searchTileView.html",d.checkUser(),a.getClass=function(b){return a.searchkey.docType==b?"active":""},a.changeView=function(){a.stLst===!0?(a.stLst=!1,a.srcViews="app/documents/search/searchTileView.html"):(a.stLst=!0,a.srcViews="app/documents/search/searchListView.html")},a.getIcon=function(a){return c.getIcon(a)},a.getDepartment=function(){b.getDepartment().success(function(b){a.dep=b,a.dep.splice(0,0,{DEP_ID:"-1",DEP_NAME:"All Department"})}).error(function(a){console.log(a)})},a.searchData=function(c){console.log(c),b.search("?docType="+a.searchkey.docType+"&dep="+a.searchkey.dep+"&page="+a.page+"&serStr="+a.search).success(function(b){a.searchres=b,console.log(b),a.noData=b.length<=0,a.$watch("curPage + itemspage",function(){var b=(a.curPage-1)*a.itemsPage,c=b+a.itemsPage;console.log(b+" "+c),a.filteredRes=a.searchres.slice(b,c)})})},a.changeDocument=function(b){a.searchkey.docType=b},a.orderMe=function(b){return a.field==b?void(a.isReverse=!a.isReverse):(a.field=b,void(a.isReverse=!1))},a.onLogout=function(){e.confirm("Are You Sure ! Do you need to Log Out?")&&b.logout()},a.goToDashboard=function(){b.goToDashboard()},a.searchData(),a.getDepartment()}),myApp.factory("documentSearchServices",function(a,b){return{get:function(){return a.get("/api/docs")},search:function(b){return a.get("/api/search"+b)},getDepartment:function(){return a.get("/api/dep")},logout:function(){b.location.href="/logout"},goToDashboard:function(){b.location.href="/profile/userDashboard"}}}),myApp.factory("iconServices",function(){return{getIcon:function(a){var b="";switch(a){case 1:b="images/documents/pdf.png";break;case 2:b="images/documents/word.png";break;case 3:b="images/documents/text.png";break;case 4:b="images/documents/image.PNG";break;case 5:b="images/documents/zip.png";break;case 6:b="images/documents/video.png";break;default:b="images/documents/all.png"}return b}}}),myApp.factory("starServices",function(a){return{setStar:function(b){return a.post("/api/setStar",b)},getStar:function(b){return a.get("/api/getStar"+b)},getStarInfo:function(b){return a.get("/getRatingInfo?id="+b)}}}),myApp.controller("singleFileUploadController",function(a,b,c,d){a.formData={ID:"",DOCCAPTION:"",DOCTYPE:"",DOCDEP:"",DOCKEY:"",DOCDESC:"",DOCFILE:""},a.docs={},a.isErr=!1,a.isNull=!0,a.docPattern="",a.search={},a.dep=[],a.type=[{id:1,type:"PDF Document",ptrn:".pdf"},{id:2,type:"Word Document",ptrn:".docx"},{id:3,type:"Slide Document",ptrn:".ppt"},{id:4,type:"Image Document",ptrn:"image/*"},{id:5,type:"Archive Document",ptrn:"*.zip|*.rar"},{id:6,type:"Video Document",ptrn:".mp4"}],c.checkAdmin(),a.getPattern=function(b){a.docPattern=a.type[b-1].ptrn},a.saveDoc=function(){alert("Saved Successfully"),document.forms.frmDoc.submit()},a.documentList=function(){b.documentList()},a.multipleFileUpload=function(){b.multipleFileUpload()},a.editForm=function(){b.edit(a.getParameterByName("id")).success(function(b){a.formData=b[0],a.getPattern(b[0].DOCTYPE)}).error(function(a){console.log(a)})},a.getParameterByName=function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)","i"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},a.getDepartment=function(){b.getDepartment().success(function(b){a.dep=b}).error(function(a){console.log(a)})},a.getDepartment(),"/documents/editDoc"==window.location.pathname&&a.editForm(),a.$on("fileSelected",function(b,c){a.$apply(function(){a.files.push(c.file)})}),a.onLogout=function(){d.confirm("Are You Sure ! Do you need to Log Out?")&&b.logout()},a.goToDashboard=function(){b.goToDashboard()}}),myApp.factory("uploadSingleServices",function(a,b){return{create:function(b){return a.post("/upload",b)},edit:function(b){return a.get("/api/docs/edit?id="+b)},getDepartment:function(){return a.get("/api/dep")},multipleFileUpload:function(){b.location.href="/documents/multipleFileUpload"},documentList:function(){b.location.href="/documents/documentList"},logout:function(){b.location.href="/logout"},goToDashboard:function(){b.location.href="/profile/adminDashboard"}}}),myApp.controller("viewDocumentController",function(a,b,c){a.doc=[],a.dep=[],a.star="",a.isAdmin=!0,a.css="star.css",a.next=[],a.thisFile="",a.files=[],a.getParameterByName=function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)","i"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},a.getUser=function(){b.getUser().success(function(b){console.log(b),"Admin"==b.mode?(a.isAdmin=!0,a.css="starDisable.css"):(a.isAdmin=!1,a.css="star.css")}).error(function(){})},a.getDocument=function(){b.edit(a.getParameterByName("id")).success(function(b){a.doc=b[0];var c=a.doc.DOCFILE;a.thisFile="uploads/documents/"+b[0].ID+"."+c.split(".").pop(),a.getStar(a.getParameterByName("id"))}).error(function(){}),5==a.getParameterByName("type")&&b.getArchieve(a.getParameterByName("id")).success(function(b){console.log(b),a.files=b}).error(function(){})},a.Download=function(){var c=a.getParameterByName("id");b.Download({ID:+c}).success(function(a){console.log(a)}).error(function(){})},a.getDepartment=function(){b.getDepartment().success(function(b){a.dep=b}).error(function(a){console.log(a)})},a.staring=function(b){alert("Thanks for your rating"+b),c.setStar({DOC_ID:+a.getParameterByName("id"),STARS:+b,STAR_DATE:new Date}).success(function(a){console.log(a)}).error(function(a){console.log(a)})},a.getStar=function(b){c.getStar("?DOC_ID="+b).success(function(b){a.star=b[0].STR}).error(function(a){console.log(a)})},a.getNext=function(c){"undefined"!=a.doc.ID&&b.getNextDoc(c).success(function(c){if(c.length>0){a.doc=c[0],a.getStar(a.doc.ID);var d=a.doc.DOCFILE;a.thisFile="uploads/documents/"+c[0].ID+"."+d.split(".").pop(),5==a.doc.DOCTYPE&&b.getArchieve(a.doc.ID).success(function(b){console.log(b),a.files=b}).error(function(){})}}).error(function(a){console.log(a)})},a.getPrevios=function(c){"undefined"!=a.doc.ID&&b.getPrevDoc(c).success(function(c){if(c.length>0){a.doc=c[0],a.getStar(a.doc.ID);var d=a.doc.DOCFILE;a.thisFile="uploads/documents/"+c[0].ID+"."+d.split(".").pop(),5==a.doc.DOCTYPE&&b.getArchieve(a.doc.ID).success(function(b){console.log(b),a.files=b}).error(function(){})}}).error(function(a){console.log(a)})},a.getUser(),a.getDocument(),a.getDepartment()}),myApp.factory("viewDocumentServices",function(a){return{get:function(){return a.get("/api/docs")},edit:function(b){return a.get("/api/docs/edit?id="+b)},getDepartment:function(){return a.get("/api/dep")},Download:function(b){return alert(b),a.post("/api/download",b)},getArchieve:function(b){return a.get("/readZip?id="+b)},getNextDoc:function(b){return a.get("/nextDoc?id="+b)},getPrevDoc:function(b){return a.get("/PrevDoc?id="+b)},getUser:function(){return a.get("/mode")}}}),function(){function a(a,b,c,d){function e(b){c.get(b).then(function(b){a.getForumQus=b.data,a.getForumQus.colspan=a.colspan,a.fliter=b.data.length,a.totalItems=a.getForumQus.length,a.$watch("curpage + itemspage",function(){var b=(a.curpage-1)*a.itemspage,c=b+a.itemspage;a.filteredDoc=a.getForumQus.slice(b,c)})})}a.getForumQus=[],a.Forumanswers=[],a.Question="",a.qusId=0,a.forumtype="All",a.Comment=[],a.colspan=3,a.curpage=1,a.itemspage=5,a.filteredDoc=[],a.maxSize=4,a.totalItems=0,a.onLogout=function(){b.confirm("Are You Sure ! Do you need to Log Out?")&&c.logout()},a.goToDashboard=function(){c.goToDashboard()},a.names=["General","News List"],a.selectedName="",a.postForumquestion=function(){var b={question:a.post.question,Type:a.selectedName,explation:a.post.Explation};c.postForumquestion(b).then(function(){a.post.question="",a.selectedName="",a.post.Explation="",alert("Successfully Inserted"),e(a.forumtype)})},a.getStar=function(b,d){var f=[b,d];c.getStar(f).then(function(){e(a.forumtype)})},a.toCheck=function(a,b){return a==b},a.GetType=function(){a.forumtype=a.Category,e(a.forumtype)},a.postAnswer=function(b,d){var f={qusId:b,Comment:d};c.postAnswer(f).then(function(){alert("Data Inserted Successfully"),a.Comment="",e(a.forumtype)})},a.sort=function(b){a.sortKey=b,a.reverse=!a.reverse},a.search=[],a.resetFilters=function(){a.search={}},a.$watch("search",function(b){a.filteredDocs=d(a.getForumQus,b),a.totalItems=a.filteredDocs.length,a.curpage=1;var c=(a.curpage-1)*a.itemspage,e=c+a.itemspage;a.filteredDoc=a.filteredDocs.slice(c,e)},!0),e(a.forumtype)}myApp.controller("forumController",a)}(),myApp.filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}}),angular.module("myApp").service("forumService",function(a,b,c){return{search:function(){},logout:function(){c.location.href="/logout"},goToDashboard:function(){c.location.href="/profile/userDashboard"},get:function(c){var d=b.defer(),e=a.get("/forum/getForum?type="+c);return e.then(function(a){d.resolve(a)},function(a){throw d.reject(a),a}),d.promise},postForumquestion:function(c){var d=b.defer(),e=a({method:"post",url:"/forum/postForumquestion",data:c});return e.then(function(a){d.resolve(a)},function(a){throw d.reject(a),a}),d.promise},getStar:function(c){var d=b.defer(),e=a({method:"post",url:"/forum/rating",data:c});return e.then(function(a){d.resolve(a)},function(a){throw d.reject(a),a}),d.promise},postAnswer:function(c){var d=b.defer(),e=a({method:"post",data:c,url:"/forum/postAnswer"});return e.then(function(a){d.resolve(a)},function(a){throw d.reject(a),a}),d.promise}}}),function(){function a(a,b,c,d,e){a.progressbar=d.createInstance(),a.userCredentials=!1,c.checkAdmin(),a.openProfilePage=function(){a.progressbar.start(),e.show("html5spinner"),c.adminProfile().then(function(){a.progressbar.complete(),e.hide("html5spinner")})},a.onLogout=function(){b.confirm("Are You Sure ! Do you need to Log Out?")&&(e.show("html5spinner"),c.logout().then(function(){e.hide("html5spinner")}))},a.openAdminDocumentation=function(){e.show("html5spinner"),c.adminDocumentaion().then(function(){e.hide("html5spinner")})},a.openProjectReg=function(){a.progressbar.start(),e.show("html5spinner"),c.projectReg().then(function(){a.progressbar.complete(),e.hide("html5spinner")})}}myApp.controller("adminDashboardController",a)}(),angular.module("myApp").factory("adminDashboardService",function(a,b,c){var d;return{pageReload:function(){b.location.reload()},logout:function(){b.location.href="/logout"},adminProfile:function(){b.location.href="/profile/adminProfile"},adminDocumentaion:function(){b.location.href="/documents/singleFileUpload"},projectReg:function(){b.location.href="/project/projectReg"},goToAdminDashboard:function(){b.location.href="/profile/adminDashboard"},checkAdmin:function(){var e=c.defer();return d=a({method:"get",url:"/getLoggedInUser"}),d.then(function(a){e.resolve(a),"admin"===a.data.userType||("user"===a.data.userType?b.location.href="/profile/userDashboard":b.location.href="/")},function(a){console.error(a)}),e.promise}}}),function(){function a(a,b,c,d,e,f,g){g.checkAdmin(),a.progressbar=d.createInstance(),a.userCredentials=!1,a.file="../images/profile/no_profile.png",a.noData=!0,a.cur_page=1,a.userDetails=[],a.userDetailsFilter=[],a.items_per_page=6,a.totalLength=0,a.max_size=Math.ceil(a.userDetails/a.items_per_page),a.search=[],a.showPagination=function(){return a.noData};var h=function(){c.getUserDetails().then(function(b){a.userDetails=b.data,a.userDetails.length>0&&(a.noData=!1,a.totalLength=a.userDetails.length,a.max_size=Math.ceil(a.totalLength/a.items_per_page),a.$watch("cur_page + items_per_page",function(){var b=(a.cur_page-1)*a.items_per_page,c=b+a.items_per_page;console.log(b+" "+c),a.userDetailsFilter=a.userDetails.slice(b,c)}))},function(a){console.error(a)})};a.goToDashboard=function(){e.show("html5spinner"),c.goToAdminDashboard().then(function(){e.hide("html5spinner")})},a.getImageSrcProfile=function(b){var c;return c=b.profile_pic?"../uploads/profile/"+b.profile_pic:b.facebook_img?"../uploads/profile/"+b.facebook_img:b.google_img?"../uploads/profile/"+b.google_img:a.file},a.getImageSrc=function(b){var c;return c=b?"../uploads/profile/"+b:a.file},a.onLogout=function(){b.confirm("Are You Sure ! Do you need to Log Out?")&&(e.show("html5spinner"),c.logout().then(function(){e.hide("html5spinner")}))},a.resetFilters=function(){a.search=[]},a.$watch("search",function(b,c){console.log("oldVal"+c),a.userDetailsFilters=f(a.userDetails,b),a.totalLength=a.userDetailsFilters.length,a.max_size=Math.ceil(a.totalLength/a.items_per_page),a.cur_page=1;var d=(a.cur_page-1)*a.items_per_page,e=d+a.items_per_page;console.log(d+" "+e),a.userDetailsFilter=a.userDetailsFilters.slice(d,e)},!0),h()}myApp.controller("adminProfileController",a)}(),myApp.filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}}),angular.module("myApp").factory("adminProfileService",function(a,b,c){var d;return{logout:function(){b.location.href="/logout"},getUserDetails:function(){var b=c.defer();return d=a.get("/getUserDetails"),d.then(function(a){b.resolve(a)},function(a){console.error(a)}),b.promise},goToAdminDashboard:function(){b.location.href="/profile/adminDashboard"}}}),function(){function a(a,b,c,d,e,f){a.progressbar=d.createInstance(),a.userCredentials=!1,f.checkUser(),a.isOldPasswordValid=function(b){return b.$dirty?b.$viewValue===a.personalData.password?(a.isPasswordEditFormValid=!0,!1):(a.isPasswordEditFormValid=!1,!0):void 0},a.isRePasswordValid=function(b,c){return c.$dirty?b.$viewValue==c.$viewValue?(a.isPasswordEditFormValid=!0,!1):(a.isPasswordEditFormValid=!1,!0):void 0},a.isPasswordValid=function(a){return a.$valid},a.isPasswordInvalid=function(a){return a.$dirty&&a.$invalid},a.updatePassword=function(d){b.confirm("Are You Sure ! Do you need to update the changes?")?(a.personalData.password=d.$viewValue,a.progressbar.start(),e.show("html5spinner"),c.updatePersonalData(a.personalData).then(function(){a.progressbar.complete(),e.hide("html5spinner"),angular.element("#result").html('<div class="alert alert-success"><button type="button" class="close">×</button>Password Changed!</div>'),b.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3),$(".alert .close").on("click",function(a){console.log("e"+a),$(this).parent().fadeTo(500,0).slideUp(500)}),$timeout(c.profilePage(),6e3)})):(e.show("html5spinner"),c.profilePage().then(function(){e.hide("html5spinner")}))},a.onCancelChangePassword=function(){b.confirm("Are You Sure ! Do you need to leave the changes?")&&(e.show("html5spinner"),c.profilePage().then(function(){e.hide("html5spinner")}))};var g=function(){c.getPersonalData().then(function(b){a.personalData=b.data,"admin"===a.personalData.userType&&(a.userCredentials=!1),null!==a.personalData.facebook_img&&(a.file="../images/uploads/"+a.personalData.facebook_img,console.log("User Profile Pic --->"+a.file)),null!==a.personalData.facebook_img&&(a.fb_link=!1),null!==a.personalData.google_img&&(a.google_link=!1)},function(a){console.error(a)})};g()}myApp.controller("changePasswordController",a)}(),angular.module("myApp").factory("changePasswordService",function(a,b,c){var d;return{pageReload:function(){b.location.reload()},logout:function(){b.location.href="/logout"},getPersonalData:function(){var e=c.defer();return d=a.get("/connect/getPersonalData"),d.then(function(a){e.resolve(a)},function(a){console.error(a),b.location.href="/logout"}),e.promise},updatePersonalData:function(b){a({method:"post",url:"/connect/updatePersonalData",data:b})},profilePage:function(){var e=c.defer();return d=a({method:"get",url:"/getLoggedInUser"}),d.then(function(a){e.resolve(a),"admin"===a.data.userType?b.location.href="/profile/adminDashboard":b.location.href="/profile/userProfile"},function(a){console.error(a)}),e.promise}}}),function(){function a(a,b,c,d){a.progressbar=c.createInstance(),a.userCredentials=!1,b.profilePage(),a.loginWithFacebook=function(){d.show("html5spinner"),b.loginWithFacebook().then(function(){d.hide("html5spinner")})},a.loginWithGoogle=function(){d.show("html5spinner"),b.loginWithGoogle().then(function(){d.hide("html5spinner")})},a.isInputValid=function(a){return a.$valid},a.isInputInvalid=function(a){return a.$dirty&&a.$invalid},a.isPasswordValid=function(a){return a.$valid},a.isPasswordInvalid=function(a){return a.$dirty&&a.$invalid},a.submit=function(a,c){d.show("html5spinner"),console.log("username --->"+a),b.verifyUser(a.$viewValue,c.$modelValue).then(function(a){""!==a?b.profilePage().then(function(){d.hide("html5spinner")}):b.loginPageWithError().then(function(){d.hide("html5spinner")})})}}myApp.controller("loginController",a)}(),angular.module("myApp").factory("loginService",function(a,b,c){var d;return{loginWithFacebook:function(){b.location.href="/auth/facebook"},loginWithGoogle:function(){b.location.href="/auth/google"},verifyUser:function(b,e){var f=c.defer();return d=a({method:"post",url:"/auth/verifyUser",data:{user:b,password:e}}),d.then(function(a){f.resolve(a.data)},function(a){console.error(a)}),f.promise},profilePage:function(){var e=c.defer();return d=a({method:"get",url:"/connect/getPersonalData"}),d.then(function(a){e.resolve(a),"admin"===a.data.userType?b.location.href="/profile/adminDashboard":"user"===a.data.userType?b.location.href="/profile/userDashboard":b.location.href="/"},function(a){console.error(a)}),e.promise}}}),function(){function a(a,b){a.progressbar=b.createInstance(),a.userCredentials=!1}myApp.controller("logoutController",a)}(),function(){function a(a,b,c,d,e){c.checkUser(),a.progressbar=d.createInstance(),a.userCredentials=!1,a.openProfilePage=function(){e.show("html5spinner"),c.userProfile().then(function(){e.hide("html5spinner")})},a.onLogout=function(){b.confirm("Are You Sure ! Do you need to Log Out?")&&(e.show("html5spinner"),c.logout().then(function(){e.hide("html5spinner")}))},a.openUserDocumentation=function(){e.show("html5spinner"),c.userDocumentation().then(function(){e.hide("html5spinner")})},a.openUserProjects=function(){e.show("html5spinner"),c.userProjects().then(function(){e.hide("html5spinner")})},a.openUserForum=function(){e.show("html5spinner"),c.openUserForum().then(function(){e.hide("html5spinner")})}}myApp.controller("userDashboardController",a)}(),angular.module("myApp").factory("userDashboardService",function(a,b,c){var d;return{pageReload:function(){b.location.reload()},logout:function(){b.location.href="/logout"},userProfile:function(){b.location.href="/profile/userProfile"},userDocumentation:function(){b.location.href="/documents/documentSearch"},userProjects:function(){b.location.href="/project/home"},checkUser:function(){var e=c.defer();return d=a({method:"get",url:"/getLoggedInUser"}),d.then(function(a){e.resolve(a),"admin"===a.data.userType?b.location.href="/profile/adminDashboard":"user"===a.data.userType||(b.location.href="/")},function(a){console.error(a)}),e.promise},openUserForum:function(){b.location.href="/forum/home"}}}),function(){function a(a,b,c,d,e,f){function g(){}f.checkUser(),a.progressbar=d.createInstance(),a.personalData=[],a.userCredentials=!0,a.editPersonalData=!1,a.imageChanged=!1,a.showLocImg=!1,a.showFbImage=!1,a.showGImage=!1,a.fb_link=!0,a.google_link=!0,a.isPasswordEditFormValid=!1,a.dataChanged=!1,a.file="../../../images/profile/no_profile.png",localStorage.$dirty||(localStorage.setItem("localView",!0),localStorage.setItem("facebookView",!1),localStorage.setItem("googleView",!1)),a.goToDashboard=function(){c.goToDashboard()},a.getView=function(a){return"local"==a&&"true"==localStorage.getItem("localView")||"facebook"==a&&"true"==localStorage.getItem("facebookView")||"google"==a&&"true"==localStorage.getItem("googleView")},a.viewChange=function(a){"local"==a?(localStorage.setItem("localView",!0),localStorage.setItem("facebookView",!1),localStorage.setItem("googleView",!1)):"facebook"==a?(localStorage.setItem("facebookView",!0),localStorage.setItem("googleView",!1),localStorage.setItem("localView",!1)):(localStorage.setItem("googleView",!0),localStorage.setItem("facebookView",!1),localStorage.setItem("localView",!1))};for(var h=(new Date).getFullYear(),i=[],j=1990;h>=j;j++)i.push(j);
a.years=i,a.dataChanges=function(){a.dataChanged=!0},a.showFacebookImage=function(){a.file="../../../uploads/profile/"+a.personalData.facebook_img},a.showGoogleImage=function(){a.file="../../../uploads/profile/"+a.personalData.google_img},a.showLocalImg=function(){a.file="../../../uploads/profile/"+a.personalData.profile_pic},a.addFacebookAccount=function(){e.show("html5spinner"),c.addFacebookAccount().then(function(b){e.hide("html5spinner"),a.personalData=b.data})},a.addGoogleAccount=function(){e.show("html5spinner"),c.addGoogleAccount().then(function(b){e.hide("html5spinner"),a.personalData=b.data})},a.uploadFile=function(b){a.imageChanged=!0,a.file=b[0]},a.fileUpload=function(){b.confirm("Are You Sure ! Do you need to update the ProfilPicture?")&&(e.show("html5spinner"),c.uploadImage(a.file).then(function(){e.hide("html5spinner"),a.imageChanged=!1,angular.element("#result").html('<div class="alert alert-success"><button type="button" class="close">×</button>Profile Picture Changed!</div>'),b.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3),$(".alert .close").on("click",function(a){console.log("e"+a),$(this).parent().fadeTo(500,0).slideUp(500)})}))},a.onCancelFileUpload=function(){a.imageChanged=!1,e.show("html5spinner"),c.getPersonalData().then(function(){e.hide("html5spinner")})},a.triggerUpload=function(){angular.element("#fileInput").trigger("click")},a.isEmailValid=function(a){return a.$valid},a.isEmailInvalid=function(a){return a.$dirty&&a.$invalid},a.isContactInvalid=function(a){return a.$dirty&&a.$invalid},a.getImageSrc=function(b){var c="";return c=b?"../../../uploads/profile/"+b:a.file},a.isOldPasswordValid=function(b){return b.$dirty?b.$viewValue==a.personalData.password?(a.isPasswordEditFormValid=!0,!1):(a.isPasswordEditFormValid=!1,!0):void 0},a.onEditPersonalData=function(){a.editPersonalData=!0},a.onSubmitPersonalData=function(){b.confirm("Are You Sure ! Do you need to update the changes?")&&(a.editPersonalData=!1,e.show("html5spinner"),c.updatePersonalData(a.personalData).then(function(){a.progressbar.complete(),e.hide("html5spinner")}),angular.element("#result").html('<div class="alert alert-success"><button type="button" class="close">×</button>Successfully updated record!</div>'),b.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},5e3),$(".alert .close").on("click",function(a){console.log("e"+a),$(this).parent().fadeTo(500,0).slideUp(500)}))},a.onCancelPersonalData=function(){b.confirm("Are You Sure ! Do you need to leave the changes?")&&(a.dataChanged=!1,a.editPersonalData=!1,k())},a.onChangePassword=function(){"admin"!=a.personalData.userType&&a.personalData.password?(e.show("html5spinner"),c.changePassword().then(function(){e.hide("html5spinner")})):e.show("NoPassword")},a.okOnCantChangePassword=function(){e.hide("NoPassword")};var k=function(){c.getPersonalData().then(function(b){a.personalData=b.data,"admin"==a.personalData.userType&&(a.userCredentials=!1),null!==a.personalData.profile_pic&&(a.file="../../../uploads/profile/"+a.personalData.profile_pic,console.log("User Profile Pic --->"+a.file)),null!==a.personalData.facebook_img&&(a.fb_link=!1,g()),null!==a.personalData.google_img&&(a.google_link=!1)},function(a){console.error(a)})};k(),a.onLogout=function(){b.confirm("Are You Sure ! Do you need to Log Out?")&&(e.show("html5spinner"),c.logout().then(function(){e.hide("html5spinner")}))}}myApp.controller("userProfileController",a)}(),angular.module("myApp").factory("userProfileService",function(a,b,c,d){var e;return{changePassword:function(){b.location.href="/profile/changePassword"},pageReload:function(){b.location.reload()},goToDashboard:function(){b.location.href="/profile/userDashboard"},addFacebookAccount:function(){b.location.href="/connect/facebook"},addGoogleAccount:function(){b.location.href="/connect/google"},logout:function(){b.location.href="/logout"},getPersonalData:function(){var d=c.defer();return e=a.get("/connect/getPersonalData"),e.then(function(a){d.resolve(a)},function(a){console.error(a),b.location.href="/error"}),d.promise},uploadImage:function(a){var b=c.defer();return e=d.upload({url:"/uploadImage",data:{file:a}}),e.then(function(a){b.resolve(a)},function(a){console.error(a)}),b.promise},updatePersonalData:function(b){var d=c.defer();return e=a({method:"post",url:"/connect/updatePersonalData",data:b}),e.then(function(a){d.resolve(a)},function(a){console.error(a)}),d.promise}}}),function(){function a(a,b,c,d){a.datas=[],a.events=[],a.myDataSource={},a.images=[],a.simpleAccordionOptions={closeOthers:!0},d.checkUser(),a.onLogout=function(){c.confirm("Are You Sure ! Do you need to Log Out?")&&b.logout()},a.goToDashboard=function(){b.goToDashboard()},b.data().success(function(b){b.length>0?(a.Total=b[0].Amount,a.Paid=b[0].Paid,a.PCode=b[0].PCode,a.Title=b[0].Title,a.DeliveryDate=b[0].DeliveryDate,a.HandledBy=b[0].HandledBy,a.EmpContact=b[0].EmpContact,a.Manager=b[0].Manager,a.ManagerContact=b[0].ManagerContact):console.log("No data found whe get /data")}).error(function(a){console.log("Error When get /data : "+a)}),b.projectHistory().success(function(b){if(b.length>0)for(var c=0;c<b.length;c++)c%2===0?a.events.push({badgeClass:"info",badgeIconClass:"glyphicon-check",title:b[c].Date,content:b[c].History}):a.events.push({badgeClass:"warning",badgeIconClass:"glyphicon-credit-card",title:b[c].Date,content:b[c].History});else console.log("No data found whe get /projectHistory")}).error(function(a){console.log("Error when get /projectHistory"+a)}),b.chartData().success(function(b){b.length>0?(a.totalPercentage=b[3].y,a.myDataSource={chart:{caption:"Last 4 Days",numberSuffix:"%",theme:"ocean"},data:[{label:b[0].x,value:b[0].y},{label:b[1].x,value:b[1].y},{label:b[2].x,value:b[2].y},{label:b[3].x,value:b[3].y}]}):console.log("No data found whe get /chartData")}).error(function(a){console.log("Error When get /chartData : "+a)}),b.imageData().success(function(b){b.length>0?a.images=b:console.log("No Project Image Found")}).error(function(a){console.log("Error when get /imageData : "+a)}),a.postData=function(){a.question.length>0?b.postQuestion(a.question).success(function(){console.log("Data Inserted Successfully"),c.alert("Data Inserted Successfully"),a.question=""}).error(function(a){console.log("Error when /postQuestion : "+a),c.alert("Data save Failed")}):console.log("question length is zero")}}myApp.controller("homeController",a)}(),myApp.factory("homeService",["$http","$window",function(a,b){return{data:function(){return a.get("/data")},projectHistory:function(){return a.get("/projectHistory")},logout:function(){b.location.href="/logout"},goToDashboard:function(){b.location.href="/profile/userDashboard"},chartData:function(){return a.get("/chartData")},imageData:function(){return a.get("/imageData")},postQuestion:function(b){return a.post("/postQuestion",[b])}}}]),function(){function a(a,b,c){a.names=["mechanical","mechatronics","ECE","CS","IT"],a.Title=["Mechanical Projects","Aeronatical Projects","ECE Projects","Embaded projects","IT Projects"],a.subHeads=["CEA-ATMEL","CEA-OTHERS","CEC-PC BASED","CEA-DSP PROJECTS","IEEE PAPERS"],a.catlogCode=["CIS-C# NET PROJECTS","CDB BIO MEDICAL PROJECTS","C,C++ AND VC++ PROJECTS","CAD/CAM/CAE PROJECTS","CIVIL DESIGN PROJECTS"],a.Domain=["RFID","ROBOTICS","BIOMEDICAL PROJECTS","C,C++ AND VC++ PROJECTS","CIVIL DESIGN Projects"],a.isEdit=!0,a.noData=!0,a.cur_page=1,a.datas=[],a.dataFilter=[],a.items_per_page=10,a.totalLength=0,a.max_size=Math.ceil(a.userDetails/a.items_per_page),a["new"]={projectCode:"",Title:"",Department:"",subHeads:"",Software:"",Hardware:"",catlogCode:"",Domain:""},a.showPagination=function(){return a.noData},a.onLogout=function(){b.confirm("Are You Sure ! Do you need to Log Out?")&&c.logout()},a.goToDashboard=function(){c.goToDashboard()},a.reverse=!1,a.searchText=[!1,!1,!1,!1,!1,!1,!1],a.visible=[!0,!0,!0,!0,!0,!0,!0],$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()}),a.order=function(b){a.predicate=b,a.predicate==b&&(a.reverse=!1)},a.order1=function(b){a.predicate=b,a.predicate==b&&(a.reverse=!0)},a.searchBox=function(b){a.searchText[b]=!0,a.visible[b]=!1},a.search1Box=function(b){a.searchText[b]=!1,a.visible[b]=!0},a.displaySave=!0,a.getFeedbacks=function(){c.getFeedbacks().success(function(b){a.datas=b,a.datas.length>0&&(a.noData=!1,a.totalLength=a.datas.length,a.max_size=Math.ceil(a.totalLength/a.items_per_page),a.$watch("cur_page + items_per_page",function(){var b=(a.cur_page-1)*a.items_per_page,c=b+a.items_per_page;console.log(b+" "+c),a.dataFilter=a.datas.slice(b,c)})),a["new"]={projectCode:"",Title:"",Department:"",subHeads:"",Software:"",Hardware:"",catlogCode:"",Domain:""}}).error(function(b){a.status="Unable to retrieve Feedbacks"+b})},a.postData=function(){var b={projectCode:a["new"].projectCode,Title:a["new"].Title,Department:a["new"].Department,subHeads:a["new"].subHeads,Software:a["new"].Software,Hardware:a["new"].Hardware,catlogCode:a["new"].catlogCode,Domain:a["new"].Domain};c.postData(b).success(function(b){alert("The Feedback Saved Successfully!!!"+b),a.getFeedbacks()}).error(function(a){alert("unable to save the feedback :"+a)})},a.editData=function(b){a.rowEdit=b,a.isEdit=!1},a.updateData=function(b,d){a.dataFilter[d].projectCode=b.projectCode,a.dataFilter[d].Title=b.Title,a.dataFilter[d].Department=b.Department,a.dataFilter[d].subHeads=b.subHeads,a.dataFilter[d].Software=b.Software,a.dataFilter[d].Hardware=b.Hardware,a.dataFilter[d].catlogCode=b.catlogCode,a.dataFilter[d].Domain=b.Domain,a.dataFilter[d].editData=!1;var e={projectCode:b.projectCode,Title:b.Title,Department:b.Department,subHeads:b.subHeads,Software:b.Software,Hardware:b.Hardware,catlogCode:b.catlogCode,Domain:b.Domain,id:a.dataFilter[a.rowEdit].id};c.updateData(e).success(function(b){alert("The Feedback Updated Successfully!!!"+b),a.rowEdit=-1,a.getFeedbacks(),a.isEdit=!0}).error(function(a){alert("Unable to update a Feedback: "+a)})},a.deleteData=function(b){c.deleteData(b).success(function(b){alert("the data deleted successfully"+b),a.getFeedbacks()}).error(function(a){alert("unable to delete a feedback"+a)})},a.getFeedbacks()}myApp.controller("projectRegController",a)}(),myApp.service("projectRegService",function(a,b){this.getFeedbacks=function(){return a.get("/getdata")},this.postData=function(b){return a.post("/postdata",b)},this.updateData=function(b){return a.post("/editdata",b)},this.deleteData=function(b){return a["delete"]("/deletedata/"+b)},this.logout=function(){b.location.href="/logout"},this.goToDashboard=function(){b.location.href="/profile/adminDashboard"}}),function(){function a(a,b,c,d){d.checkUser(),c.submit=function(){c.uploadForm.file.$valid&&c.file&&c.upload(c.file)},c.onLogout=function(){b.confirm("Are You Sure ! Do you need to Log Out?")&&(b.location.href="/logout")},c.upload=function(d){a.upload({url:"/upload",data:{file:d}}).then(function(a){0===a.data.errorCode?b.alert("Success "+a.config.data.file.name+"uploaded. Response: "):b.alert("an error occured")},function(a){console.log("Error status: "+a.status),b.alert("Error status: "+a.status)},function(a){console.log(a);var b=parseInt(100*a.loaded/a.total);console.log("progress: "+b+"% "+a.config.data.file.name),c.progress="progress: "+b+"% "})}}myApp.controller("uploadController",a)}(),module.exports=function(a){var b=require("../controllers/documents.documentList.server.controller.js");a.get("/api/search",b.searchDocument),a.get("/api/docs/edit",b.editDocument),a.post("/api/docs/delete",b.deleteDocument)},module.exports=function(a){var b=require("../controllers/documents.multipleFileUpload.server.controller");a.post("/uploadMulti",b.uploadMultiple)},module.exports=function(a){var b=require("../controllers/documents.search.server.controller");a.get("/api/search",b.searchDocument)},module.exports=function(a){var b=require("../controllers/documents.singleFileUpload.server.controller");a.post("/documents/upload",b.upload),a.get("/api/dep",b.getDepartment)},module.exports=function(a){var b=require("../controllers/documents.star.server.controller");a.get("/api/getStar",b.getStar),a.post("/api/setStar",b.setStar),a.get("/getRatingInfo",b.getRatingInfo)},module.exports=function(a){var b=require("../controllers/documents.viewDocument.server.controller");a.get("/readZip",b.readZip),a.get("/api/download",b.downloadDocument),a.get("/viewDocument",b.viewDocument),a.get("/nextDoc",b.nextDocument),a.get("/prevDoc",b.prevDocument),a.get("/mode",b.userMode)},module.exports=function(a){var b=require("../controllers/forum.home.server.controller.js");a.use("/forum",b)},module.exports=function(a){var b=require("../controllers/layout.server.controller.js");a.get("*",b.layout)},module.exports=function(a){},module.exports=function(a){var b=require("../controllers/profile.adminProfile.server.controller");a.get("/getUserDetails",b.getUserDetails)},module.exports=function(a){require("../controllers/layout.server.controller.js")},module.exports=function(a){var b=require("../controllers/profile.login.server.controller");a.use("/auth",b)},module.exports=function(a){var b=require("../controllers/profile.logout.server.controller");a.get("/logout",b.logout)},module.exports=function(a){},module.exports=function(a){var b=require("../controllers/profile.userProfile.server.controller");a.use("/connect",b)},module.exports=function(a){var b=require("../controllers/project.home.server.controller.js");a.get("/data",b.data),a.get("/projectHistory",b.projectHistory),a.get("/chartData",b.chartData),a.get("/imageData",b.imageData),a.post("/postQuestion",b.postQuestion)},module.exports=function(a){var b=require("../controllers/project.projectReg.server.controller");a.get("/getdata",b.getData),a.post("/postdata",b.postData),a.post("/editdata",b.EditData),a["delete"]("/deletedata/:id",b.DeleteData)},module.exports=function(a){var b=require("../controllers/project.upload.server.controller.js");a.post("/upload",b.upload)},module.exports=function(a){var b=require("../controllers/security.server.controller");a.get("/getLoggedInUser",b.getLoggedInUser)};